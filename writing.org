#+title: Writing

Configuration for writing with Emacs, specifically for Markdown and Org mode.

#+begin_src emacs-lisp
  ;;; -*- lexical-binding: t -*-
#+end_src

* Org
** Toggle markup visibility with visible mode
#+begin_src emacs-lisp
  (with-eval-after-load "org"
    (define-key org-mode-map (kbd "C-c v") 'visible-mode))
#+end_src

** More TODO state changes

#+begin_src emacs-lisp
  (setq org-todo-keywords
        '((sequence "TODO(t)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELED(c@)"))
        ;; LOGBOOK
        org-log-into-drawer t)
#+end_src

** Org Roam
#+begin_src emacs-lisp
  (straight-use-package 'org-roam)

  (setq org-roam-directory (expand-file-name "~/org/roam"))
  (setq org-roam-dailies-directory (expand-file-name "~/org/daily"))

  ;; Use gpg encryption for files
  (setq org-roam-capture-templates '(("d" "default" plain "%?"
       :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org.gpg"
                          "#+title: ${title}\n")
       :unnarrowed t)))

  (setq org-roam-dailies-capture-templates
        '(("d" "default" entry
           "* %?"
           :target (file+head "%<%Y-%m-%d>.org.gpg"
                              "#+title: %<%Y-%m-%d>\n"))))

  (defvar org-roam-keymap
    (let ((keymap (make-keymap)))
      (define-key keymap "l" 'org-roam-buffer-toggle)
      (define-key keymap "f" 'org-roam-node-find)
      (define-key keymap "g" 'org-roam-graph)
      (define-key keymap "i" 'org-roam-node-insert)
      (define-key keymap "c" 'org-roam-capture)
      (define-key keymap "s" 'org-roam-db-sync)
      (define-key keymap "t" 'org-roam-dailies-goto-today)
      (define-key keymap "y" 'org-roam-dailies-goto-yesterday)
      (define-key keymap "T" 'org-roam-dailies-goto-tomorrow)
      (define-key keymap "d" 'org-roam-dailies-goto-date)
      keymap))

  (defalias 'org-roam-keymap org-roam-keymap)

  (global-set-key (kbd "C-c r") 'org-roam-keymap)

  (setq org-roam-db-gc-threshold most-positive-fixnum)

  (with-eval-after-load "org-roam"
    (org-roam-setup)
    (org-roam-db-autosync-mode))
#+end_src

** Good old template shortcut

#+begin_src emacs-lisp
  (with-eval-after-load "org"
    (require 'org-tempo))
#+end_src

** Using variable pitch font

Enable ~variable-pitch-mode~.

#+begin_src emacs-lisp
  (add-hook 'org-mode-hook 'variable-pitch-mode)

  (with-eval-after-load "org"
    ;; Use fixed pitch for table and code
    (custom-set-faces
     '(org-table ((t :inherit 'fixed-pitch-serif)))
     '(org-code ((t :inherit 'fixed-pitch-serif)))
     '(org-block ((t :inherit 'fixed-pitch-serif)))
     '(org-checkbox ((t :inherit 'fixed-pitch :background unspecified :box nil)))
     '(org-latex-and-related ((t (:inherit 'fixed-pitch-serif))))))
#+end_src

** Better structure indication with org-visual-outline

~org-visual-outline~ provides a better visual feedback for document structure.

#+begin_src emacs-lisp
  (straight-use-package '(org-visual-outline :host github
                                             :repo "egalnonsense/org-visual-outline"))

  (autoload 'org-visual-indent-mode "org-visual-indent")

  (add-hook 'org-mode-hook 'org-visual-indent-mode)
  (add-hook 'org-mode-hook 'org-dynamic-bullets-mode)
#+end_src

** Ricing markups

#+begin_src emacs-lisp
  (when window-system

    (defun meomacs--org-prettify-symbols ()
      (setq-local prettify-symbols-alist
                  '(("#+begin_src" . "¬ª")
                    ("#+end_src" . "¬´")
                    ("#+begin_example" . "‚ùØ")
                    ("#+end_example" . "‚ùÆ")
                    ("#+begin_quote" . "‚Äü")
                    ("#+end_quote" . "‚Äü")
                    ("[X]" . "‚¶ø")
                    ("[ ]" . "üûÜ")
                    ("[-]" . "‚¶æ")))
      (prettify-symbols-mode 1))

    (add-hook 'org-mode-hook 'meomacs--org-prettify-symbols)

    (setq org-hide-emphasis-markers t)

    (with-eval-after-load "org"
      (add-to-list 'org-emphasis-alist '("=" (:box (:line-width -2 :color "gray50" :style released-button) :inherit org-verbatim)))))
#+end_src

** Babel

#+begin_src emacs-lisp
  (setq org-confirm-babel-evaluate nil)

  (with-eval-after-load "org"
    (org-babel-do-load-languages
     'org-babel-load-languages
     '((R . t)
       (dot . t))))

  (defun meomacs-after-babel-execute ()
    (when org-inline-image-overlays
      (org-redisplay-inline-images)))

  (add-hook 'org-babel-after-execute-hook 'meomacs-after-babel-execute)
#+end_src

** Latex
#+begin_src emacs-lisp
  (with-eval-after-load "org"
    (setq org-format-latex-options (plist-put org-format-latex-options :scale 4.0)))
#+end_src

** Agenda

#+begin_src emacs-lisp
  (setq org-agenda-files (list (expand-file-name "~/Org")))
#+end_src
* Markdown

#+begin_src emacs-lisp
  (straight-use-package 'markdown-mode)
  (straight-use-package 'edit-indirect)
#+end_src

** Keybindings

#+begin_src emacs-lisp
  (with-eval-after-load "markdown-mode"
    (define-key markdown-mode-map (kbd "C-c v") 'markdown-toggle-markup-hiding))
#+end_src

* Uniline

Draw graphics with unicode

#+begin_src emacs-lisp
  (straight-use-package '(uniline :host github
                                  :repo "tbanel/uniline"))
#+end_src

** Meow integration

#+begin_src emacs-lisp
  (add-hook 'uniline-mode-hook
            (lambda ()
              (if (bound-and-true-p uniline-mode)
                  (meow--switch-to-motion)
                (meow--switch-to-normal))))
#+end_src
